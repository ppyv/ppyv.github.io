<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="このサイトの組み立て方"><title>Hugo と GitHub Pages と Actions</title><link rel=canonical href=https://ppyv.github.io/p/2020/10/18/ghpages/><link rel=stylesheet href=/scss/style.min.css><meta property="og:title" content="Hugo と GitHub Pages と Actions"><meta property="og:description" content="このサイトの組み立て方"><meta property="og:url" content="https://ppyv.github.io/p/2020/10/18/ghpages/"><meta property="og:site_name" content="Kobayashi Yasuhiro"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="github"><meta property="article:tag" content="hugo"><meta property="article:published_time" content="2020-10-18T12:04:30+09:00"><meta property="article:modified_time" content="2020-10-18T12:04:30+09:00"><meta property="og:image" content="https://ppyv.github.io/img/avatar.png"><meta name=twitter:site content="@ppyv"><meta name=twitter:title content="Hugo と GitHub Pages と Actions"><meta name=twitter:description content="このサイトの組み立て方"><meta name=twitter:card content="summary"><meta name=twitter:image content="https://ppyv.github.io/img/avatar.png"><script async src="https://www.googletagmanager.com/gtag/js?id=G-SQPE8PDWHM"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-SQPE8PDWHM');</script><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;700&display=swap" rel=stylesheet><style>:root{--base-font-family: "Lato", var(--sys-font-family), "Noto Sans JP"}</style><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"></head><body><div class="container flex on-phone--column align-items--flex-start extended article-page with-toolbar"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=メニューを開く・閉じる>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header class=site-info><figure class=site-avatar><img src=/img/avatar_hu25a85f98930b548da27a77b91facb539_108299_300x300_resize_box_2.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
<span class=emoji>💬</span></figure><h1 class=site-name><a href=https://ppyv.github.io>Kobayashi Yasuhiro</a></h1><h2 class=site-description>電話の形をした技術者もどき</h2></header><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/about><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg><span>About</span></a></li><li><a href=/archives><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li></ol></aside><main class="main full-width"><div id=article-toolbar><a href=https://ppyv.github.io class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>Back</span></a></div><article class=main-article><header class=article-header><div class=article-details><h2 class=article-title><a href=/p/2020/10/18/ghpages/>Hugo と GitHub Pages と Actions</a></h2><h3 class=article-subtitle>このサイトの組み立て方</h3><footer class=article-time><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--published>2020/10/18</time></footer></div></header><section class=article-content><p><a class=link href=/p/2020/10/11/hugo/>最初のポスト</a> とタイトルがほぼかぶっているが、
このポストでは具体的にどのようにこのサイトを組み立てたかを記録する。</p><h1 id=手順>手順</h1><h2 id=repository-の準備>Repository の準備</h2><p>GitHub Pages の個人ページとして立ち上げることを考えていたため、 ppyv.github.io の名を持つリポジトリを立ち上げる。
リポジトリのページであれば名前はなんでもよい（ <code>http://&lt;username>.github.io/&lt;reponame></code> となる）。</p><h2 id=hugo-の準備>Hugo の準備</h2><p>このセクションの内容は <a class=link href=https://gohugo.io/getting-started/quick-start/ target=_blank rel=noopener>Hugo Quick Start</a> と大差がない。</p><h3 id=ルートディレクトリの初期化>ルートディレクトリの初期化</h3><p><code>hugo new site ${sitename}</code> で立ち上げられるが、そのときの挙動が
「カレントディレクトリの下に、 <code>${sitename}</code> を持つディレクトリを掘って、必要なアセットを置く」となっている。
このとき <code>${sitename}</code> と同じ名前を持つディレクトリがあるとコマンドが失敗終了する。</p><p>前の手順で、 GitHub.com や GitHub Desktop などで Create repository してから Clone してくる方式をとる場合、
この制限に引っかかる。 <code>--force</code> オプションをつけるとこの制限を回避できる。</p><h3 id=テーマを引っ張ってくる>テーマを引っ張ってくる</h3><p>テーマがないとレンダリングがまともにできないので、 <a class=link href=https://themes.gohugo.io/ target=_blank rel=noopener>Hugo Themes</a> などから探してくる。</p><p>見つかったらルートディレクトリの下にある <code>themes</code> に追加する。
わたしは Git のサブモジュール機能を使ったが、単に Clone してくるだけでもよいだろう。</p><p>今回利用したのは <a class=link href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener>Hugo Theme Stack</a> である (Thanks Jimmy!) 。</p><p><code>config.toml</code> に <code>theme = hugo-theme-stack</code> などと指定するのも忘れずに。</p><h3 id=optional-configtoml-のチューニング>(Optional) config.toml のチューニング</h3><p>テーマには exampleSite が存在することが多い。そこから config.toml を引っ張ってくることで、設定を煮詰める土台として使うことができる。</p><h3 id=記事を書く>記事を書く</h3><p>割愛。</p><h2 id=github-actions-の準備>GitHub Actions の準備</h2><p><a class=link href=https://github.co.jp/features/actions target=_blank rel=noopener>GitHub Actions</a> は GitHub.com 備え付けのワークフロー自動化ツールである。
ありがたいことにパブリックリポジトリでは無料で使うことができ、プライベートリポジトリでも無料枠が用意されている。</p><p>イメージとしては GitHub 上で動く VM 上で何かさせるものではあるが、 GitHub 上に「プリセット」のようなものがいくつか存在する。
今回は次の 2 つを利用した。</p><ul><li><a class=link href=https://github.com/peaceiris/actions-hugo target=_blank rel=noopener>GitHub Actions for Hugo</a></li><li><a class=link href=https://github.com/peaceiris/actions-gh-pages target=_blank rel=noopener>GitHub Actions for GitHub Pages</a></li></ul><p>それぞれ Hugo のビルドを行う、ビルドされた HTML などを GitHub Pages のお作法に基づいてデプロイする Action である (Thanks peaceiris-san!) 。</p><p><code>/.github/workflows/</code> ディレクトリ以下に YAML でワークフローを記載していく。
今回は <code>gh-pages.yml</code> ファイルに記述している。ファイル名はなんでもよい。
2020/10/18 時点でコミットしてあるファイルは次の内容になっている。</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nn>---</span><span class=w>
</span><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build sites</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=l>main</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>deploy</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-18.04</span><span class=w>
</span><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Checkout</span><span class=w>
</span><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v2</span><span class=w>
</span><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>submodules</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w>          </span><span class=nt>fetch-depth</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span><span class=w>
</span><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Setup Hugo</span><span class=w>
</span><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>peaceiris/actions-hugo@v2</span><span class=w>
</span><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>hugo-version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;latest&#39;</span><span class=w>
</span><span class=w>          </span><span class=nt>extended</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w>
</span><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build</span><span class=w>
</span><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>hugo --minify</span><span class=w>
</span><span class=w>
</span><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>deploy</span><span class=w>
</span><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>peaceiris/actions-gh-pages@v3</span><span class=w>
</span><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>github_token</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.GITHUB_TOKEN }}</span><span class=w>
</span><span class=w>          </span><span class=nt>publish_dir</span><span class=p>:</span><span class=w> </span><span class=l>./public</span><span class=w>
</span><span class=w>          </span><span class=nt>cname</span><span class=p>:</span><span class=w> </span><span class=l>blog.kbys.info</span><span class=w>
</span></code></pre></div><p>どんな環境でも大方これで稼働する<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>が、最終行の <code>cname</code> は環境によって値が異なる<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>。
これは GitHub Pages を独自ドメインで運用する場合に必要なパラメーターであり、必要がなければ行ごと削除する。</p><p>また on セクションのブランチ名は環境によって異なる。デフォルトブランチ名が main の人はこのままでよいし、 master の人は master にしなければならない。
このセクションは「main ブランチにプッシュがあったとき、このワークフローが発火する」ことを意味している。
ここをいじることで、異なるタイミング（Pull request が飛んできたとき、など）に発火するワークフローも組める。
例えば Lint して、その結果を PR 側に表示させることもできる。</p><h2 id=github-pages-の設定>GitHub Pages の設定</h2><p>GitHub のリポジトリページで Settings を開くと、下の方に GitHub Pages のセクションがある。</p><p>ここで次のように設定する。</p><ul><li>Source: Branch を <code>None</code> から <code>gh-pages</code> に、 Folder を <code>/ (root)</code> にして Save する。</li></ul><p>これで画面上に表示された URL から成果物にアクセスできるようになった。</p><h1 id=日頃の運用>日頃の運用</h1><p>記事を書いて master (main) ブランチに Commit & Push するだけで、自動的にビルド＆デプロイが行われる。</p><h1 id=まとめ>まとめ</h1><p>Hugo と GitHub Actions, GitHub Pages を組み合わせることで、簡易に Web サイトを構築・提供する方法を説明した。</p><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p>もっともこのコンフィグも GitHub Actions for Hugo リポジトリの README から引っ張ってきたものと本質的な差がない。 <a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p>最初この設定が漏れていて、ワークフローが発火して走行するたびに独自ドメインが 404 になる事象があったことは内緒である。 GitHub Pages がカスタムドメインを「公開フォルダのルートにある、 CNAME ファイルに記録している」仕様を把握していなかったことによる凡ミスだった。 <a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></section><footer class=article-footer><section class=article-tags><a href=/tags/github/>github</a>
<a href=/tags/hugo/>Hugo</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Kobayashi Yasuhiro 2020</span></section></footer></article><aside class=related-contents--wrapper></aside><footer class=site-footer><section class=copyright>&copy; 2020 Kobayashi Yasuhiro</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=1.1.0>Stack</a></b> designed by
<a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true style=display:none><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const customFont=document.createElement('link');customFont.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";customFont.type="text/css";customFont.rel="stylesheet";document.head.appendChild(customFont);}());</script><link rel=stylesheet href=/css/highlight/light.min.css media="(prefers-color-scheme: light)"><link rel=stylesheet href=/css/highlight/dark.min.css media="(prefers-color-scheme: dark)"></body></html>